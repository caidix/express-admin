{"version":3,"sources":["pages/Admin/Article/index.js"],"names":["Option","Select","TextArea","Input","marked","setOptions","renderer","Renderer","gfm","pedantic","sanitize","tables","breaks","smartLists","smartypants","normalCenter","textAlign","marginBottom","AddArticle","props","useState","title","setTitle","author","setAuthor","keyword","setKeyword","articleId","setArticleId","articleContent","setArticleContent","markdownContent","setMarkdownContent","introduction","setIntroducemd","introducehtml","setIntroducehtml","moment","addTime","setAddTime","category","setCategory","categoryList","setCategoryList","tags","setTags","tagsList","setTagsList","origin","setOriginStatus","changeContent","value","html","changeIntroduce","e","target","submitArticle","draft","a","message","error","data","url","_id","http","method","res","status","success","history","push","info","get","then","code","catch","console","log","useEffect","location","query","map","item","isEditArticle","getCategory","getTags","gutter","type","justify","span","style","addonBefore","size","placeholder","name","onChange","maxLength","className","dangerouslySetInnerHTML","__html","onClick","rows","onPressEnter","defaultValue","allowClear","width","date","flexShrink","mode","key","id"],"mappings":"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","file":"static/js/6.4c1935c3.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport marked from 'marked'\r\nimport SimpleMDE from \"react-simplemde-editor\";\r\nimport \"easymde/dist/easymde.min.css\";\r\nimport './index.scss'\r\nimport moment from 'moment'\r\nimport { Row, Col, Input, Select, Button, DatePicker, message } from 'antd'\r\nimport http from '@/utils/http.js'\r\nconst { Option } = Select;\r\nconst { TextArea } = Input;\r\nmarked.setOptions({\r\n  renderer: marked.Renderer(),\r\n  gfm: true,\r\n  pedantic: false,\r\n  sanitize: false,\r\n  tables: true,\r\n  breaks: false,\r\n  smartLists: true,\r\n  smartypants: false,\r\n});\r\nconst normalCenter = {\r\n  textAlign: 'center',\r\n  marginBottom: 10,\r\n};\r\nfunction AddArticle(props) {\r\n  const [title, setTitle] = useState('');\r\n  const [author, setAuthor] = useState('');  // 作者 \r\n  const [keyword, setKeyword] = useState('');  // 关键字 \r\n  const [articleId, setArticleId] = useState(0)  // 如果为编辑的文章，则存入编辑文章的ID\r\n  const [articleContent, setArticleContent] = useState('')  //markdown的编辑内容\r\n  const [markdownContent, setMarkdownContent] = useState('预览内容') //html内容\r\n  const [introduction, setIntroducemd] = useState('')            //简介的markdown内容\r\n  const [introducehtml, setIntroducehtml] = useState('等待编辑') //简介的html内容\r\n  const [addTime, setAddTime] = useState(moment())   //发布日期\r\n  const [updateDate, setUpdateDate] = useState() //修改日志的日期\r\n  const [typeInfo, setTypeInfo] = useState([]) // 文章类别信息\r\n  const [category, setCategory] = useState() //选择的文章类别\r\n  const [categoryList, setCategoryList] = useState([]) //可供选择的选择的文章类别\r\n  const [tags, setTags] = useState() //选择的标签类别\r\n  const [tagsList, setTagsList] = useState([]) //可供选择的选择的标签类别\r\n  const [origin, setOriginStatus] = useState(0) //选择文章来源\r\n  const changeContent = (value) => {\r\n    setArticleContent(value)\r\n    let html = marked(value)\r\n    setMarkdownContent(html)\r\n  }\r\n  const changeIntroduce = (e) => {\r\n    setIntroducemd(e.target.value)\r\n    let html = marked(e.target.value)\r\n    setIntroducehtml(html)\r\n  }\r\n  const changeOriginStatus = (value) => {\r\n    setOriginStatus(value);\r\n  }\r\n  const changeDatePicker = (date) => {\r\n    setAddTime(date);\r\n  }\r\n  const submitArticle = async (draft) => {\r\n    if (!title) {\r\n      message.error('标题不能为空!'); return;\r\n    }\r\n    if (!author) {\r\n      message.error('作者不能为空!'); return;\r\n    }\r\n    if (!articleContent) {\r\n      message.error('文章内容不能为空!'); return;\r\n    }\r\n    if (!category) {\r\n      message.error('文章类别不能为空!'); return;\r\n    }\r\n    let data = {\r\n      title,\r\n      author,\r\n      keyword,\r\n      articleContent,\r\n      introduction,\r\n      addTime: addTime || moment(),\r\n      category,\r\n      origin,\r\n      draft,\r\n      tags\r\n    }\r\n    let url = '/admin/article/add'\r\n    if (articleId) {\r\n      data._id = articleId;\r\n      url = '/admin/article/edit';\r\n    }\r\n    let res = await http({\r\n      method: 'post',\r\n      data,\r\n      url\r\n    })\r\n    if (res.data.data.status === 1) {\r\n      message.success(articleId ? '修改成功!' : '添加成功!')\r\n      props.history.push('/article/articleList')\r\n    } else {\r\n      message.error(res.data.data.info)\r\n    }\r\n  }\r\n  const isEditArticle = () => {\r\n    if (props.location.query) {\r\n      let data = props.location.query.data;\r\n      setTitle(data.title)\r\n      setAuthor(data.author)\r\n      setArticleId(data._id)\r\n      setKeyword(data.keyword)\r\n      setOriginStatus(data.origin)\r\n      let category = data.category.map(item => (item._id))\r\n      let tags = data.tags.map(item => (item._id))\r\n      setCategory(category)\r\n      setTags(tags)\r\n      changeIntroduce({ target: { value: data.introduction } })\r\n      changeContent(data.articleContent)\r\n      console.log(props)\r\n    }\r\n  }\r\n  async function getCategory() {\r\n    await http.get('/admin/category/get').then(({ data }) => {\r\n      if (data.code == 0) {\r\n        setCategoryList(data.data);\r\n      }\r\n    }).catch(error => {\r\n      console.log(error);\r\n    })\r\n  }\r\n  async function getTags() {\r\n    await http.get('/admin/tag/get').then(({ data }) => {\r\n      if (data.code == 0) {\r\n        setTagsList(data.data);\r\n      }\r\n    }).catch(error => {\r\n      console.log(error);\r\n    })\r\n  }\r\n  useEffect(() => {\r\n    isEditArticle()\r\n    getCategory()\r\n    getTags()\r\n  }, [])\r\n  return (\r\n    <div>\r\n      <Row gutter={5} type=\"flex\" justify=\"space-between\">\r\n        <Col span={18}>\r\n          <Input\r\n            style={normalCenter}\r\n            addonBefore=\"标题\"\r\n            size=\"large\"\r\n            placeholder=\"标题\"\r\n            name=\"title\"\r\n            value={title}\r\n            onChange={(e) => { setTitle(e.target.value); }}\r\n          />\r\n          <Input\r\n            style={normalCenter}\r\n            addonBefore=\"作者\"\r\n            size=\"large\"\r\n            placeholder=\"作者\"\r\n            name=\"author\"\r\n            value={author}\r\n            onChange={(e) => { setAuthor(e.target.value); }}\r\n          />\r\n          <Input\r\n            style={normalCenter}\r\n            addonBefore=\"关键字\"\r\n            size=\"large\"\r\n            placeholder=\"关键字\"\r\n            name=\"keyword\"\r\n            value={keyword}\r\n            maxLength={200}\r\n            onChange={(e) => { setKeyword(e.target.value); }}\r\n          />\r\n          <Row gutter={10} >\r\n            <Col span={12}>\r\n              <SimpleMDE value={articleContent}\r\n                className=\"markdown-content\"\r\n                onChange={changeContent}\r\n                placeholder=\"文章内容\" />\r\n            </Col>\r\n\r\n            <Col span={12}>\r\n              <div dangerouslySetInnerHTML={{ __html: markdownContent }}\r\n                className=\"show-html\">\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </Col>\r\n\r\n        <Col span={6}>\r\n          <Row>\r\n            <Col span={24} className=\"article-button\">\r\n              <Button size=\"large\" onClick={() => { submitArticle(1) }}>暂存文章</Button>&nbsp;\r\n              <Button type=\"primary\" size=\"large\" onClick={() => { submitArticle(0) }}>发布文章</Button>\r\n              <br />\r\n            </Col>\r\n\r\n            <Col span={24}>\r\n              <TextArea className=\"article-introduction\"\r\n                rows={4}\r\n                placeholder=\"文章简介\"\r\n                value={introduction}\r\n                onChange={changeIntroduce}\r\n                onPressEnter={changeIntroduce}\r\n              />\r\n              <div className=\"introduce-html\"\r\n                dangerouslySetInnerHTML={{ __html: '文章简介：' + introducehtml }}>\r\n              </div>\r\n            </Col>\r\n\r\n            <Col span={24}>\r\n              <div className=\"date-select\">\r\n                <DatePicker\r\n                  defaultValue={addTime}\r\n                  allowClear={false}\r\n                  placeholder=\"发布日期\"\r\n                  style={{ width: \"100%\", marginBottom: 10 }}\r\n                  onChange={changeDatePicker}\r\n                />\r\n              </div>\r\n            </Col>\r\n            <Col span={24}>\r\n              <Select\r\n                style={{ width: '100%', flexShrink: 1, marginBottom: '10px' }}\r\n                placeholder=\"选择文章来源\"\r\n                value={origin}\r\n                onChange={changeOriginStatus}\r\n              >\r\n                {/* 0 原创，1 转载，2 混合 */}\r\n                <Select.Option value={0}>原创</Select.Option>\r\n                <Select.Option value={1}>转载</Select.Option>\r\n                <Select.Option value={2}>混合</Select.Option>\r\n              </Select>\r\n              <Select value={category}\r\n                onChange={setCategory}\r\n                mode=\"multiple\"\r\n                placeholder=\"文章分类\"\r\n                style={{ width: '100%', flexShrink: 1, marginBottom: '10px' }}>\r\n                {/* 0 文章分享 2 视频教程 */}\r\n                {\r\n                  categoryList.map((item) => (\r\n                    <Option value={item._id} key={item.id}>{item.name}</Option>\r\n                  ))\r\n                }\r\n              </Select>\r\n              <Select value={tags}\r\n                onChange={setTags}\r\n                mode=\"multiple\"\r\n                placeholder=\"标签\"\r\n                style={{ width: '100%', flexShrink: 1 }}>\r\n                {\r\n                  tagsList.map((item) => (\r\n                    <Option value={item._id} key={item.id}>{item.name}</Option>\r\n                  ))\r\n                }\r\n              </Select>\r\n\r\n            </Col>\r\n          </Row>\r\n        </Col>\r\n      </Row>\r\n    </div >\r\n  )\r\n}\r\nexport default AddArticle"],"sourceRoot":""}